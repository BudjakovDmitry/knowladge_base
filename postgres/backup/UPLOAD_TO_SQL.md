# Выгрузка в SQL

Идея заключается в генерации текстового файла с командами SQL, которые при выполнении на сервере пересоздадут базу данных в том же самом состоянии, в котором она была на момент выгрузки. PostgreSQL предоставляет для этой цели вспомогательную программу pg_dump. Простейшее применение этой программы выглядит так:

```bash
pgdump db_name > dump_file
```

pg_dump выводит результат своей работы в поток стандартного вывода. Показанная выше команда создает текстовый файл, однако pg_dump может создавать файлы в других форматах, которые допускаю параллельную обработку, и более гибкое восстановление объектов.

Программа pg_dump является для PostgreSQL обычным клиентским приложением. Это означает, что вы можете выполнять процедуру резервного копирования с любого удаленного компьютера, если имеете доступ к нужной базе данных. pg_dump не использует для своей работы какие-то специальные привилегии. В частности, обычно ей требуется доступ на чтение всех таблиц, которые необходимо выгрузить, так что для копирования всей базы данных практически всегда ее нужно запускать с правами суперпользователя СУБД. Если у Вас нет достаточных прав для копирования всей базы данных, вы, тем не менее, можете сделать резервную копию той части базы, доступ к которой у Вас есть, используя такие параметры, как `-n schema` или `-t table`.

Указать, к какому серверу должна подключаться программа pg_dump, можно с помощью арументов командной строки `-h server` и `-p port`. По умолчанию в качестве сервера выбирается localhost или значение, указанное в переменной окружения `PGHOST`. Подобным образом, по умолчанию используется порт, заданный в переменной окружения PGPORT, а если она не задана, то порт, указанный по умолчанию при компиляции.

Как и любое другое клиентское приложение PostgreSQL, pg_dump по умолчанию будет подключаться к базе данных с именем пользователя, совпадающим с именем текущего пользователя операционной системы. Чтобы переопределить имя, либо добавьте парамер -U, либо установите переменную окружения `PGUSER`. pg_dump подключается к серверу через обычные механизмы проверки подлинности клиента.

Важное преимущество pg_dump в сравнении с другими методами резервного копирования состоит в том, что вывод pg_dump обычно можно загрузить в более новые версии PostgreSQL, в то время как резервная копия на уровне файлоыой системы и непрерывное архивирование жестко зависят от версии сервера. Также, только метод с применением pg_dump будет работать при переносе базы данных на другую машинную архитектуру, например, при переносе с 32-битной на 64-битную версию сервера.

Дампы, создаваемые pg_dump, являются внутренне согласованными, то есть, дамп представляет собой снимок базы данных на момент начала запуска pg_dump. pg_dump не блокирует другие операции с базой данных во время ее работы. Исключение составляют операции, которым нужна исключительная блокировка, как например, большинство форм команды ALTER TABLE).
