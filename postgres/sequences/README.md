# Последовательности

В Postgresql существуют последовательности (sequences). С ними можно работать явно или неявно. Неявно мы работаем с последовательнстями, когда назначаем столбцам тип данных serial. Тип данных serial основан на последовательностях и при вставке записей в таблицу, в этом поле значение будет генерироваться автоматически с инкрементом.

Чтобы явно создать последовательности, существует команда:

```sql
CREATE SEQUENCE [IF NOT EXISTS] seq_name
[INCREMENT n]
[MINVALUE i]
[MAXVALUE j]
[START WITH k];
```

Имя последовательности должно быть уникальным.

По умолчанию инкремент равен 1, но значение можно изменить.

```sql
CREATE SEQUENCE seq1;  --создать последовательность с инкрементом 1
CREATE SEQUENCE seq2 INCREMENT 15;  --создать последовательность с инкрементом 15;
```

По умолчанию первое значение равно 1. Это можно изменить, задав параметр MINVALUE. Чтобы ограничить максимальное значение используется парамтер MAXVALUE. При попытке увеличить значение больше максимального, возникнет ошибка.

```sql
CREATE SEQUENCE seq1
MINVALUE 10
```

Чтобы сгенерировать следующее значение в последовательности, нужно вызвать функцию `nextval` и передать ей в качестве аргумента имя последовательности.

```sql
SELECT nextval('seq_name');
```

Чтобы получить текущее значени последовательности, используется функция currval('seq_name');

```sql
SELECT currval('seq_name');
```

Функция 'lastval' возвращает последнее значение, сгенерированное какой-либо из последовательностей в текущей сессии. Функция не принимает аргументов.

```sql
SELECT lastval();
```

`setval(seq_name, new_val, modify_currval)` позволяет задать значение последовательности.

* seq_name::str - имя последовательности
* new_val::int - какое значение установить в последовательности
* modify_currval::bool - Если передать false, то currval не модифицируется, там остается старое значение, а nextval будет генерировать значения начиная с new_val включительно. Если передать true, то currval модифицируется, а nextval будет возвращать значения с currval + 1. Необязательный, по умолчанию true.

```sql
SELECT setval('seq_name', 10, true);  --10
SELECT currval('seq_name');  --10
SELECT nextval('seq_name');  --11

SLECT setval('seq_name', 10, false);  --10
SELECT currval('seq_name');  --11
SELECT nextval('seq_name');  --10
```

## Переименование последовательности

```sql
ALTER SEQUENCE seq_name RENAME TO new_seq_name;
```

## Рестарт последовательности

```sql
--перезапустить поседовательность. Начальным значением будет 10.
ALTER SEQUENCE seq_name RESTART WITH 10;
```

## Удаление последовательности

```sql
DROP SEQUENCE seq_name;
```
