# pg_dump

## Ситаксис

```bash
pg_dump [connection-param][param...][db_name]
```

## Описание

pg_dump - это программа для создания резервных копий базы данных PostgreSQL. Она создает целостные копии, даже если база параллельно используется. pg_dump не препятствует доступу других пользователей к базе данных (ни для чтения, ни для записи).

pg_dump выгружает только одну базу данных. Чтобы выгрузить весь кластер или сохранить глабельные объекты, относяиеся ко всем базам в кластере, например, роли и табличные пространства, нужно воспользоваться программой pg_dumpall.

Выгружаемые данные могут быть сохранены в виде скрипта, либо в одном из архивных форматов. Скрипты передставляют собой текстовые файлы, содержащие SQL-команды, необходимые для воссоздания базы данных до состояния на момент создания скрипта. Для восстановления из скрипта, его содержимое нужно передать в psql. Скрипты можно использовать для восстановления базы на других машинах, в том числе с иной архитектурой, а с некоторыми корректировками, даже в других СУБД.

Для восстановления из архивных форматов файлов используется утилита pg_restore. Эти форматы позволяют указывать pg_restore какие объекты базы данных восстанавливать, а также позволяет изменить порядок следования восстанавливаемых объектов. Архивные форматы файлов спроектированы так, чтобы их можно было переносить на другие платформы с другой архитерктурой.

Применение архивных форматов в сочетании утилит pg_restore и pg_dump позволяет организовывать эффективный механизм архивирования и переноса данных. pg_dump можно использовать для резервирования всей базы даных, а затем при применение pg_restore выбрать нужные объекты для восстановления. Наиболее гибкие форматы выходных файлов - это "custom" и "directory". Они позволяют выбрать и изменить порядок объектов, поддерживают восстановление в несколько потоков, а также сжимаются по умолчанию. При этом только формат "directory" поддерживает выгрузку данных в несколько потоков.

## Параметры

__имя_бд__

Указывает имя базы данных, из которой будут выгружены данные. Если имя не задано, то используется значения переменной окружения `PGDATABASE`. Если и переменаня не задана, то в качестве имени базы будет взято имя пользователя, под которым осуществляется подключение.

---

__-f file__<br>
__--file=file__

Отправить вывод в указанный файл. Параметр можно не указывать, если используется формат с выводом в файл. В этом случае буде использован стандартный поток вывода. Для формата с выводом в каталог параметр является обязательным и должен задавать путь к каталогу. В этом случае целевой каталог будет создан командой pg_dump и не должен существовать заранее.

---

__-F format__<br>
__--format=format__

Указывает формат вывода копии. format может принимать следующие значения:

* `p`, `plain` - сформировать текстовый SQL-скрипт. Это поведение по умолчанию.
* `c`, `custom` - выгрузить данные в специальном архивном формате, пригодном для дальнейшего использования утилитой pg_restore. Наряду с порматом directory является наиболее гибким форматом, позволяющим вручную выбирать и сортировать восстанавливаемые объекты. Вывод в этом формате по умолчанию сжимается.
* `d`, `directory` - выгрузить данные в формате каталога. Этот формат пригоден для дальнейшего использования утилитой pg_restore. При этом будет создан каталог, в котором для каждой таблицы и большого объекта будут созданы отдельные файлы, а также файл оглавления в машинно читаемом формате, понятном для pg_restore. С полученной резервной копией можно работать штатными средствами Unix, например, несжатую копию можно сжать посредством gzip. Этот формат по умолчанию сжимается, а также поддерживает работу в несколько потоков.
* `t`, `tar` - выгрузить данные в формате tar, для дальнейшего использования утилитой pg_restore. Этот формат совместим с форматом вывода в каталог: если архив распаковать, получится корректная копия в формате каталога. Однако формат tar не поддерживает сжатие. Также, применяя формат tar, при восстановлении нельзя изменить относительный порядок элементов данных.

---

__-t template__<br>
__--table=template__

Выгрузить только таблицы, соответствующие шаблону template. В этом контексте под "таблицей" подразумеваются также представления, материализованные представления, последовательности и сторонние таблицы.

---

__-h server__<br>
__host=server__

Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета. Значение по умолчанию берется из переменной окружения `PGHOST`, если она установлена. В противном случае выполнится подключение к Unix-сокету.

---

__-U user_name__<br>
__--username=user_name__

Имя пользователя под которым производится подключение.
