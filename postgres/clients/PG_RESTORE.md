# pg_restore

## Синтаксис

```bash
pg_restore [connection-param...][param...][file_name]
```

## Описание

Утилита pg_restore предназначена для восстановления базы данных PostgreSQL из архива, созданного командой pg_dump в любом из не текстовых форматов. При наличии файлов архивов, pg_restore может восстанавливать данные избирательно или даже переупорядочить данные перед восстановлением. Формат файлов архива не привязан к архитектуре.

pg_restore может работать в двух режимах. Если указывается имя базы данных, pg_restore подключается к этой базе данных и восстанавливает содержимое архива непосредственно в нее. В противном случае создается SQL-скрипт с командами, необходимыми для пересоздания базы данных, который затем выводится в файл или стандартный поток вывода. Сформированный скрипт будет в точности соответствовать выводу pg_dump в простом текстовом формате.

## Параметры

__file_name__

Указывает расположение восстанавливаемого файла архива (или каталога, для архива в формате каталога). По умолчанию используется поток стандартного ввода.

---

__-d db_name__<br>
__--dbname=db_name__

Подключиться к базе данных db_name и восстановить данные непосредственно в нее. В данном аргументе может задаваться строка подключения. В этом случае параметры в строке подключения переопределяют одноименные параметры, заданные в командной строке.

---

__-f file_name__<br>
__--file=file_name__

Задает файл для вывода сгенерированного скрипта или списка объектов, получаемого с параметром -l. Чтобы выбрать stdout, используйте -.

---

__-F format__<br>
__--format=format__

Задает формат архива. Указывать формат необязательно, так как pg_restore определяет формат автоматически. Но если формат задается, то допускается один из вариантов:

* `c`, `custom` - архив сохранен в специальном формате pg_dump
* `d`, `directory` - архив сохранен в каталоге
* `t`, `tar` - архив сохранен в формате `tar`

---

__-j jobs-number__<br>
__--jobs=jobs-number__

Выполнять наиболее длительные этапы pg_restore (в частности загрузку данных, создание индексов или ограничений) параллельно, используя несколько заданий (в количестве, не превышающем jobs-number). Это позволяет кардинально сократить время восстановления большой базы данных, когда сервер работает на многопроцессорном компьютере. Данный параметр игнорируется, когда генерируется скрипт (нет прямого подключения к базе данных).

Этот параметр поддерживается только с архивом в специальном формате или каталоге. Входные данные должны поступать из обычного файла или каталога, а из стандартного потока ввода.

Каждое задание выполняется в отдельном потоке и использует отдельное подключение к серверу.

Оптимальное значение этого параметра зависит от аппаратной конфигурации сервера, клиента и сети. В частности, имеет значение количество процессорных ядер и устройство дискового хранилища. В качетсве начального значения можно выбрать число ядер на сервере, но и при увеличении этого значения во многих случаях восстановление будет быстрее. При слишком больших значениях производительность упадет из-за перегрузки.

Несколько заданий НЕ могут выполнятся в сочетании с параметром --single-tranasction.
