# psql

Утилита psql входит в стандартную поставку СУБД PostgreSQL. Она предназначена для доступа к серверу баз данных. Это терминальный клиент для работы с PostgreSQL. Она позволяет интерактивно вводить запросы, передавать их в PostgreSQL и видеть результаты. Также запросы могут быть получены из файла или из аргументов командной строки.

## Синтаксис

```
psql [parameter...][db_name [user_name]]
```

## Параметры

-d database_name<br>
--dbname=database_name<br>

Указывает имя базы данных для подключения. Равнозначно укзанию database_name в первом аргументе, не являющимся ключом, в командной строке. Вместо имени может задаваться строка подключения. В этом случае параметры в строке подключения переопределяют одноименные параметры, заданные в командной строке.

```bash
psql dbname
# или
psql -d dbname
```

---

-h computer<br>
--host=computer<br>

Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета.

---

-l<br>
--list

Выводит список всех доступных баз данных и завершает работу. Другие параметры, не связанные с соединением, игнорируются. Это похоже на метакоманду \list.

Когда используется этот аргумент, psql будет подключаться к базе данных postgres, если только в командной строке не задана другая база данных (в параметре -d или через запись службы, но не через переменную окружения).

---

-p port<br>
--port=port

Указывает TCP-порт или расширение файла локального UNIX-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной среды PGPORT, если она установлена, либо числом, заданным при компиляции, обычно 5432.

---

-U user_name<br>
--username=user_name

Использовать для подключения к БД имя_пользователя вместо подразумеваемого по умолчанию.

Для запуска psql нужно ввести команду:

```bash
psql
```

Получение справки
```bash
psql --help
```

## Подключение к БД

Если имя базы не указать, она будет выбрана по имени пользователя.

Приглашение к вводу команды выглядит так:

```bash
dbname=>
```

или

```bash
dbname=#
```

Во второй случае показывается, что мы являемся суперпользователем.

Подключение к базе данных `db_name` используя учетную запись пользователя `username`.
```bash
psql -d db_name -U username
```

Выполнить скрипт из файла
```bash
psql -f script.sql -U username
```

Создание базы данных
```bash
createdb -U username db_name
```

При вводе SQL команд можно использовать клавишу Tab для автодополнения вводимого клчевого слова или имени таблицы БД.

Для того, чтобы прекратить ввод команды нужно надать Ctrl+C.

## Сервисные команды

В утилите psql есть множество внутренних команд, которые начинаются с обратной косой черты "\". За некоторыми командами, например \d могут скрываться сложные SQL-запросы к системным таблицам БД. Утилита psql избавляет пользователя от необходимости вводить их.

* `\?` - получение краткой справки по всем сервисным командам
* `\h` - получить список всех SQL-команд
* `\i` - считывает и выполняет команды из заданного файла

   `\i script.sql`

* `\q` - выйти из psql

Получение справки по команде
```
\h CREATE TABLE
```

Посмотреть список всех таблиц и представлений, созданных в БД, к которой сейчас подключены:

```
\dt
```

Посмотреть структуру таблицы

```
\d table_name
```

Посмотреть структуру таблицы с подробным описанием

```
\d+ table_name
```

Посмотреть список схем

```
\dn
```

Посмотреть список индексов

```
\di
или
\di+
```

Включить и выключить секундомер. При включенном секундомере, psql будет сообщать время, затраченное на выполнение всех команд.

```
\timing on
\timing off
```

Подключиться к базе данных

```
\connect db_name
\c db_name
```
