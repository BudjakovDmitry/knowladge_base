# Массивы

## Объявление типа массива

PostgreSQL позволяет создавать в таблицах такие столбцы, в которых будут содержаться не скалярные значения, а массивы переменной длинны. Эти массивы могут быть многомерными и могут содержать значения любого из встроенных типов, а также типов данных, определенных пользователем.

Пример создания массива

```sql
CREATE TABLE pilots
(
    pilot_name text,
    schedule integer[],
    airplains text[]
);
```

Для указания того, что это массив, нужно добавить квадратные скобки к именованию типа данных. Задавать число элементов необязательно.

Создание двумерного массива: `schedule text[][]`

Указание точного размера массива: `squares integer[3][3]`. Число размерностей неограничено.

Все элементы массива считаются одного типа вне зависимости от его размера и числа размерностей. Явно указывать число элементов или размерностей в команде CREATE TABLE имеет смысл только для документирования, на механизм работы с массивом это не влияет.

Для объявления одномерных массивов можно применять альтернативную запись с ключевым словом ARRAY. Столбец schedule можно было бы определить как на примере ниже (с указанием размера или без указания):

```sql
schedule integer ARRAY[4],
schedule integer ARRAY
```

## Ввод значений массива

В виде константы значения элементов массива заключаются в фигурные скобки и разделяются запятыми. Значения элементов массива можно заключить в двойные кавычки, а если он содержит запятые или фигурные скобки, то это нужно сделать обязательно.

Общий формат константы массива:

`'{value1 separator value2 separator ...}'`

separator - символ, указанный в качестве разделителя соответствующей записи в таблице pg_type. Для стандартных типов даных разделителем является запятая (,), за исключением типа box, в котором разделитель - точка с запятой (;). Каждое значение - это либо константа типа элемента массива, либо вложенный массив.

Пример константы массива. Она определяет двумерные массив 3x3, состоящий из трех вложенных массивов целых чисел. На сомом деле такие константы изначально воспринимаются как строка и передается процедуре преобразования вводимого массива. При этом может потребоваться явно указать целевой тип.

```sql
'{{1, 2, 3}, {4, 5, 6}, {7, 8, 9}}'
```

Чтобы присвоить элементу массива значение NULL, достаточно просто написать `NULL`.

В многомерных массивах число элементов в каждой размерности должно быть одинаковым. В противном случае возникнет ошибка. Так нельзя:

```sql
'{{1, 2, 3}, {4, 5}}'
```

В команде вставки массив представлен в виде строкового литерала с указанием типа данных и квадратных скобок, означающих массив.

```sql
INSERT INTO pilots
VALUES ('Ivan', '{1, 3, 5, 6, 7}'::integer[], '{"Boeing-737", "Airbus-A220"}'),
       ('Petr', '{1, 2, 5, 7}'::integer[], '{"Tu-214", "Airbus-A219"}'),
```

Можно использовать синтаксис конструктора ARRAY

```sql
INSERT INTO pilots
VALUES ('Semen', ARRAY[2, 4, 5], ARRAY['Boeing-747', 'Cessna-172']),
```

Стоит отметить, что в первом случае строки в массиве заключаются в двойные кавычки, а в синтаксисе c конструктором ARRAY элементы массива - это простые SQL константы или выражения. Поэтому строки заключаются в одинарные апострофы, а не в двойные.

## Обращение к массивам

Индексы элементов массивов записываются в квадратных скобках. По умолчанию нумерация начинается с 1.

```sql
SELECT name FROM pilots WHERE schedule[1] = 1;
SELECT planes[1] FROM pilots;
```

Можно получать срезы массива. Срез обозначается как `нижняя-граница:верхняя-граница` для одной или нескольких размерностей. Обе границы включаются.

```sql
SELECT schedule[1:3] FROM pilots;
```
