# Dockerfile

Файл Dockerfile содержит набор инструкций, следуя которым, Docker будет собирать образ. Этот файл содержит описание базового образа, который будет представлять собой исходный слой образа. Поверх базового образа можно добавлять дополнительные слои. Практически каждая команда в Dockerfile создает новый слой.

Пример докерфайла

```dockerfile
FROM python3.8

RUN mkdir /opt/app
WORKDIR /opt/app

COPY hello.py /opt/app

CMD ["python", "hello.py"]
```

__FROM__ говорит, какой базовый образ использовать. Базовый образ - это образ, на основе которого будет создан наш образ. В нашем примере базовым будет образ Python с тегом 3.8.

__RUN__ говорит, что нужно выполнить какую-то команду. В примере мы создаем папку. Создание папки добавляет слой в образ.

__WORKDIR__ говорит, какая папка будет рабочей. Все относительные ссылки будут строится относительно рабочей директории. Эта команда также добавляет слой.

__COPY__ говорит, что нужно что-то скопировать. В нашем случае нужно скопировать файл hello.py из текущей директории хост-машины внутрь папки /opt/app в образе.

---

__ADD__ - эта команда похожа на COPY, но ее функциональность немного шире. Например, ADD умеет на лету распаковывать архив, может подключать ресурсы с какого-нибудь url. Если не знаешь, какую команду использовать, то используй COPY.

```bash
ADD custom.conf /etc/nginx/conf.d/
```

---

__CMD__ запускает наш скрипт

Примеры

```dockerfile
CMD ["nginx", "-g", "daemon off;"]
```

---

__EXPOSE__ - говорит Докеру, что нужно открыть порт с указанным номером. `EXPOSE 80`.

Порт открывается в сети docker и не пробрасывается на хостовую машину.

---

__ENV__ устанавливает переменные окружения. Например, переменной FOO присваивается значение bar: `ENV FOO bar`.

## Слои

Как было сказано выше, практически каждая команда добвляет новый слой в образ и результирующий образ собирвется из получившихся слоев. У такого подхода есть достоинство: если изменить какой-то из слоев, например запустить не "hello.py", а "main.py", то фактически это новый образ, но все слои которые создавались до команды `CMD ["python", "hello.py"]` будут переиспользованы, а в новом образе будет создан только один новый слой: `CMD ["python", "main.py"]`
